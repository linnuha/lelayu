<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Reset Password</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"></script>
</head>
<body class="d-flex justify-content-center align-items-center vh-100" style="background:#f8fafc;">
<div class="card p-4 rounded-2xl" style="width:100%; max-width:400px;">
<h5 class="mb-3 text-center">Reset Password</h5>
<div id="formContainer"><p>Memeriksa link...</p></div>
</div>

<script>
const SUPABASE_URL = "https://eltuoqlqsvtvcwhpkbbz.supabase.co"; // ganti
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVsdHVvcWxxc3Z0dmN3aHBrYmJ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI1NjE0MjUsImV4cCI6MjA2ODEzNzQyNX0.eHMoIeeihLuoKKST5K04FaPEguRdas5L2BsEV2ek3w0";
const client=supabase.createClient(SUPABASE_URL,SUPABASE_ANON_KEY);
const formContainer=document.getElementById('formContainer');

const params=new URLSearchParams(window.location.search);
const access_token=params.get('access_token');

if(!access_token){ formContainer.innerHTML='<p class="text-danger">Link reset tidak valid.</p>'; }
else{
  formContainer.innerHTML=`
    <div class="mb-3">
      <input type="password" id="newPassword" class="form-control" placeholder="Password baru">
    </div>
    <button id="btnSetNewPass" class="btn btn-primary w-100">Ganti Password</button>
  `;
  document.getElementById('btnSetNewPass').addEventListener('click', async()=>{
    const newPassword=document.getElementById('newPassword').value.trim();
    if(!newPassword) return alert('Isi password baru');
    const { error }=await client.auth.updateUser({ access_token,password:newPassword });
    if(error) return alert(error.message);
    formContainer.innerHTML=`<p class="text-success text-center">Password berhasil diperbarui. <a href="index.html">Login di sini</a></p>`;
  });
}
</script>

</body>
</html>
